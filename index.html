import React, { useState, useEffect } from 'react';

// --- Ícones (SVGs) ---
const LockClosedIcon = () => ( <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" className="w-5 h-5"><path fillRule="evenodd" d="M10 1a4.5 4.5 0 00-4.5 4.5V9H5a2 2 0 00-2 2v6a2 2 0 002 2h10a2 2 0 002-2v-6a2 2 0 00-2-2h-.5V5.5A4.5 4.5 0 0010 1zm3 8V5.5a3 3 0 10-6 0V9h6z" clipRule="evenodd" /></svg> );
const UserIcon = () => ( <svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" /></svg> );
const LogoutIcon = () => ( <svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" /></svg> );
const MenuIcon = () => ( <svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 6h16M4 12h16m-7 6h7" /></svg> );
const CloseIcon = () => ( <svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" /></svg> );
const SparkleIcon = () => ( <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fillRule="evenodd" d="M10.868 2.884c.321.64.321 1.415 0 2.055L9.43 6.493a1 1 0 101.414 1.414l1.555-1.554a2.945 2.945 0 014.163 4.163l-1.555 1.554a1 1 0 101.414 1.414l1.43-1.43a4.95 4.95 0 00-7.001-7.001L10.868 2.884zM2.94 15.05a4.95 4.95 0 007.001 7.001l1.43-1.43a1 1 0 00-1.414-1.414l-1.555 1.554a2.945 2.945 0 01-4.163-4.163l1.555-1.554a1 1 0 00-1.414-1.414l-1.43 1.43z" clipRule="evenodd" /></svg> );
const SearchIcon = () => ( <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" /></svg> );
const UploadIcon = () => ( <svg className="w-8 h-8" fill="currentColor" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M16.88 9.1A4 4 0 0 1 16 17H5a5 5 0 0 1-1-9.9V7a3 3 0 0 1 4.52-2.59A4.98 4.98 0 0 1 17 8c0 .38-.04.74-.12 1.1zM11 11h3l-4 4-4-4h3V3h2v8z" /></svg> );
const LocationMarkerIcon = () => ( <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" /><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" /></svg> );
const ChevronDownIcon = () => ( <svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 9l-7 7-7-7" /></svg> );
const ExternalLinkIcon = () => ( <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" /></svg> );


// --- Estrutura de Ícones e Módulos ---
const moduleIcons = {
  Dashboard: () => <svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" /></svg>,
  Overview: () => <svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" /></svg>,
  AnáliseDeDadosEIA: () => <svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13 10V3L4 14h7v7l9-11h-7z" /></svg>,
  DetecçãoDeFraudes: () => <svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" /><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" /></svg>,
  VerificaçãoDeDocumentos: () => <svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" /></svg>,
  AutomaçãoDaDefesa: () => <svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M11 4a2 2 0 114 0v1a1 1 0 001 1h3a1 1 0 011 1v3a1 1 0 01-1 1h-1a2 2 0 100 4h1a1 1 0 011 1v3a1 1 0 01-1 1h-3a1 1 0 01-1-1v-1a2 2 0 10-4 0v1a1 1 0 01-1 1H7a1 1 0 01-1-1v-3a1 1 0 011-1h1a2 2 0 100-4H7a1 1 0 01-1-1V6a1 1 0 011-1h3a1 1 0 001-1V4z" /></svg>,
  GestãoDeRiscos: () => <svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>,
  ConsultaDoAdverso: () => <svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" /></svg>,
  ResoluçãoDeDisputas: () => <svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z" /></svg>,
};

const modules = [
  { id: 'Dashboard', name: 'Dashboard', icon: moduleIcons.Dashboard },
  { id: 'Overview', name: 'Overview', icon: moduleIcons.Overview },
  { id: 'AnáliseDeDadosEIA', name: 'Análise de Dados e IA', icon: moduleIcons.AnáliseDeDadosEIA },
  { id: 'DetecçãoDeFraudes', name: 'Detecção de Fraudes', icon: moduleIcons.DetecçãoDeFraudes },
  { id: 'VerificaçãoDeDocumentos', name: 'Verificação de Documentos', icon: moduleIcons.VerificaçãoDeDocumentos },
  { id: 'AutomaçãoDaDefesa', name: 'Automação da Defesa', icon: moduleIcons.AutomaçãoDaDefesa },
  { id: 'GestãoDeRiscos', name: 'Gestão de Riscos', icon: moduleIcons.GestãoDeRiscos },
  { id: 'ConsultaDoAdverso', name: 'Consulta do Adverso', icon: moduleIcons.ConsultaDoAdverso },
  { id: 'ResoluçãoDeDisputas', name: 'Resolução de Disputas', icon: moduleIcons.ResoluçãoDeDisputas },
];

const mockCasesData = [ { id: 1, caseNumber: "0000245-50.2024.2.00.0501", parties: { plaintiff: "GRUPO CASAS BAHIA S.A.", defendant: "Diversos Advogados" }, subject: "Pedido de Providências", status: "Em Análise na Corregedoria", riskLevel: "Alto", value: 1000.00, details: { summary: "Pedido de Providências para apurar a prática de litigância predatória por diversos advogados, com base na Recomendação 159/2024 do CNJ.", indicators: ["Causas de pedir idênticas mesmo em relações de trabalho distintas.","Prática de assédio processual.","Cooptação de clientela e de testemunhas.","Concentração de grande volume de demandas (2.124 processos) sob patrocínio de poucos profissionais."], documents: ["Decisão Corregedoria (Id. 5366780)", "Recomendação CNJ 159/2024"]}}, { id: 2, caseNumber: "0100771-66.2022.5.01.0226", parties: { plaintiff: "Reclamante Individual", defendant: "VIA VAREJO S.A." }, subject: "Reclamação Trabalhista", status: "Extinto sem Res. de Mérito", riskLevel: "Crítico", value: 45000.00, details: { summary: "Ação julgada como demanda predatória pela 6ª Vara do Trabalho de Nova Iguaçu, resultando na extinção do processo por falta de interesse de agir.", indicators: ["Identidade de objeto de pedir e volume de ações.","Padronização de pedidos e alegações genéricas.","Causas de pedir não refletem a realidade do contrato de trabalho.","Inspeções judiciais comprovaram a regularidade do ponto eletrônico da empresa, contradizendo as alegações."], documents: ["Sentença 6ª VT NI (Id. 5332454)"]}}, { id: 3, caseNumber: "1046543-64.2025.8.26.0100", parties: { plaintiff: "Goes Engenharia Ltda", defendant: "Sul América Serviços de Saúde S/A" }, subject: "Reajuste Contratual Abusivo", status: "Em Andamento", riskLevel: "Médio", value: 208901.88, details: { summary: "Ação cominatória para suspender reajustes por sinistralidade aplicados de 2016 a 2025 e pedir restituição de valores pagos.", indicators: ["Questionamento de reajustes retroativos (últimos 10 anos), o que pode indicar falta de urgência.","Patrocínio por escritório com alto volume de ações similares contra a mesma operadora (Vilhena Silva).","Ausência de prova pré-constituída de irregularidade, segundo decisão inicial."], documents: ["Contestação Sul América", "Parecer Jurídico sobre Saúde Suplementar"]}}, { id: 4, caseNumber: "1057186-81.2025.8.26.0100", parties: { plaintiff: "Paciente", defendant: "Sul América Companhia de Seguro Saúde" }, subject: "Negativa de Cobertura (TAVI)", status: "Liminar Deferida", riskLevel: "Baixo", value: 350000.00, details: { summary: "Ação para garantir cobertura de procedimento TAVI negado pela operadora. Tutela de urgência deferida com base na gravidade do quadro clínico.", indicators: ["Demanda baseada em necessidade médica urgente e comprovada por relatório.","Tema com jurisprudência variável (rol da ANS exemplificativo vs. taxativo)."], documents: ["Relatório Médico", "Decisão de Tutela de Urgência"]}}, ];
const cnjIndicators = [ { id: 'g', title: "Ações com Petições Genéricas", description: "Distribuição de ações semelhantes com petições genéricas, mascarando a realidade dos fatos.", cpc: "art. 80, II e V, CPC" }, { id: 'l', title: "Concentração de Demandas", description: "Concentração de grande volume de demandas em poucos profissionais, sem coincidência com a sede de atuação ou domicílio das partes.", cpc: "art. 80, III e V, CPC" }, { id: 'm', title: "Assédio Processual", description: "Ajuizamento de ações com o objetivo de dificultar os direitos da parte contrária.", cpc: "art. 80, III e V, CPC" }, { id: 'd', title: "Foro Inadequado (Forum Shopping)", description: "Ajuizamento de ações em comarcas distantes do domicílio das partes ou do local do fato sem justificativa.", cpc: "art. 80, III e V, CPC" }, { id: 'k', title: "Ação sem Documentos Essenciais", description: "Ajuizamento de ações sem documentos essenciais, tornando a pretensão contrária a fato incontroverso.", cpc: "art. 80, I, V e VI, CPC" } ];

const riskAnalysisData = {
    "1": { risks: [ { type: "Risco Reputacional", probability: "Alta", impact: "Alto", description: "A alegação de litigância predatória em larga escala pode gerar publicidade negativa, afetando a imagem da empresa perante o mercado e o judiciário.", mitigation: "Elaborar uma estratégia de comunicação proativa. Publicar notas de esclarecimento e fortalecer a imagem da empresa como cumpridora de suas obrigações." }, { type: "Risco Processual", probability: "Média", impact: "Alto", description: "Risco de a Corregedoria acatar o pedido e suspender a tramitação de mais de 2.000 processos, impactando a gestão de passivos e o andamento processual.", mitigation: "Atuar ativamente no Pedido de Providências, apresentando contra-argumentos sólidos e demonstrando a legitimidade das defesas nos casos individuais." } ] },
    "2": { risks: [ { type: "Risco Financeiro", probability: "Baixa", impact: "Baixo", description: "O processo foi extinto, minimizando o risco financeiro direto. No entanto, o custo da defesa já foi incorrido.", mitigation: "Analisar a viabilidade de ação de regresso para reaver custos, se aplicável. Utilizar a decisão como precedente em casos futuros." }, { type: "Risco de Precedente", probability: "Positivo", impact: "Alto", description: "A decisão de extinção por litigância predatória cria um precedente favorável extremamente valioso para ser usado em outras ações com o mesmo padrão.", mitigation: "Catalogar e disseminar a decisão para toda a equipe jurídica. Utilizar como jurisprudência central em contestações de casos similares." } ] },
    "3": { risks: [ { type: "Risco Financeiro", probability: "Média", impact: "Alto", description: "Caso a tese de afastamento dos reajustes seja acatada, o impacto financeiro será significativo, incluindo a restituição de valores e a redução da receita futura do contrato.", mitigation: "Preparar uma defesa técnica robusta, com perícia atuarial demonstrando a necessidade e correção dos reajustes com base na sinistralidade. Argumentar a legalidade das cláusulas contratuais." }, ] }
};


// --- Componentes ---

const LoginPage = ({ onLogin }) => {
  const [email, setEmail] = useState('advogado@exemplo.com');
  const [password, setPassword] = useState('senha123');
  const [error, setError] = useState('');
  const handleLogin = (e) => { e.preventDefault(); if (email && password) { onLogin(); } else { setError('Por favor, preencha todos os campos.'); } };
  return ( <div className="flex items-center justify-center min-h-screen bg-gray-100 font-sans"> <div className="w-full max-w-md p-8 space-y-8 bg-white rounded-lg shadow-xl"> <div className="text-center"><h1 className="text-3xl font-bold text-gray-800">Plataforma</h1><p className="mt-2 text-sm text-gray-600">Combate à Litigância Abusiva</p></div> <form className="mt-8 space-y-6" onSubmit={handleLogin}> <input id="email-address" name="email" type="email" required className="appearance-none rounded-none relative block w-full px-3 py-3 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-t-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm" placeholder="Endereço de e-mail" value={email} onChange={(e) => setEmail(e.target.value)} /> <input id="password" name="password" type="password" required className="appearance-none rounded-none relative block w-full px-3 py-3 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-b-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm" placeholder="Senha" value={password} onChange={(e) => setPassword(e.target.value)} /> {error && <p className="text-red-500 text-xs text-center">{error}</p>} <div className="text-sm"> <a href="#" className="font-medium text-indigo-600 hover:text-indigo-500"> Esqueceu sua senha? </a> </div> <button type="submit" className="group relative w-full flex justify-center py-3 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500"> <span className="absolute left-0 inset-y-0 flex items-center pl-3"> <LockClosedIcon className="h-5 w-5 text-indigo-500 group-hover:text-indigo-400" /> </span> Entrar </button> </form> </div> </div> );
};

const Sidebar = ({ activeModule, onSelectModule, onLogout, isSidebarOpen, fraudAlert }) => {
  return (
    <aside className={`bg-gray-800 text-gray-100 flex flex-col transition-all duration-300 ease-in-out ${isSidebarOpen ? 'w-64' : 'w-20'}`}>
      <div className={`flex items-center justify-center h-20 border-b border-gray-700 ${isSidebarOpen ? 'px-4' : ''}`}>
        <h1 className={`text-xl font-bold text-white ${isSidebarOpen ? '' : 'hidden'}`}>Anti-Fraude</h1>
        <div className={`text-xl font-bold text-white ${isSidebarOpen ? 'hidden' : 'block'}`}>AF</div>
      </div>
      <nav className="flex-1 px-2 py-4 space-y-2">
        {modules.map((module) => {
            const isFraudModule = module.id === 'DetecçãoDeFraudes';
            const isActive = activeModule === module.id;
            let customClass = 'hover:bg-gray-700';
            if (isActive) {
                customClass = 'bg-indigo-600';
            } else if (isFraudModule && fraudAlert) {
                customClass = 'bg-red-600 animate-pulse';
            }
            return (
              <a key={module.id} href="#" onClick={(e) => { e.preventDefault(); onSelectModule(module.id); }} className={`flex items-center p-2 text-base font-normal rounded-lg transition-colors ${customClass} ${!isSidebarOpen ? 'justify-center' : ''}`}>
                <module.icon />
                <span className={`ml-3 ${!isSidebarOpen ? 'hidden' : 'block'}`}>{module.name}</span>
              </a>
            );
        })}
      </nav>
      <div className="px-2 py-4 mt-auto border-t border-gray-700">
        <a href="#" onClick={onLogout} className={`flex items-center p-2 text-base font-normal rounded-lg hover:bg-gray-700 transition-colors ${!isSidebarOpen ? 'justify-center' : ''}`}>
          <LogoutIcon />
          <span className={`ml-3 ${!isSidebarOpen ? 'hidden' : 'block'}`}>Sair</span>
        </a>
      </div>
    </aside>
  );
};

const Dashboard = ({ onSelectModule }) => (
  <div>
    <h2 className="text-3xl font-semibold text-gray-800 mb-6">Painel de Controle</h2>
    <div className="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">
      {modules.filter(m => m.id !== 'Dashboard').map((module) => (
        <div key={module.id} className="bg-white p-6 rounded-lg shadow-md hover:shadow-xl hover:-translate-y-1 transition-all cursor-pointer flex flex-col items-center text-center" onClick={() => onSelectModule(module.id)}>
          <div className="text-indigo-600 mb-4"> <module.icon /> </div>
          <h3 className="text-lg font-semibold text-gray-700">{module.name}</h3>
        </div>
      ))}
    </div>
  </div>
);

const OverviewModule = () => {
    const [selectedCase, setSelectedCase] = useState(null);
    const totalValue = mockCasesData.reduce((acc, c) => acc + c.value, 0);
    const highRiskCases = mockCasesData.filter(c => c.riskLevel === 'Alto' || c.riskLevel === 'Crítico').length;
    const getRiskColor = (level) => {
        switch (level) {
            case 'Crítico': return 'bg-red-200 text-red-800';
            case 'Alto': return 'bg-yellow-200 text-yellow-800';
            case 'Médio': return 'bg-blue-200 text-blue-800';
            case 'Baixo': return 'bg-green-200 text-green-800';
            default: return 'bg-gray-200 text-gray-800';
        }
    };
    return (
        <div>
            <h2 className="text-3xl font-semibold text-gray-800 mb-6">Overview dos Casos</h2>
            <div className="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                <div className="bg-white p-5 rounded-lg shadow-md"><h4 className="text-gray-500 text-sm font-medium">TOTAL DE CASOS</h4><p className="text-3xl font-bold text-gray-800">{mockCasesData.length}</p></div>
                <div className="bg-white p-5 rounded-lg shadow-md"><h4 className="text-gray-500 text-sm font-medium">RISCO ALTO/CRÍTICO</h4><p className="text-3xl font-bold text-red-600">{highRiskCases}</p></div>
                <div className="bg-white p-5 rounded-lg shadow-md"><h4 className="text-gray-500 text-sm font-medium">VALOR TOTAL DAS CAUSAS</h4><p className="text-3xl font-bold text-gray-800">{totalValue.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })}</p></div>
            </div>
            <div className="bg-white rounded-lg shadow-md overflow-hidden">
                <table className="min-w-full divide-y divide-gray-200">
                    <thead className="bg-gray-50">
                        <tr><th scope="col" className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nº do Processo</th><th scope="col" className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Parte Adversa</th><th scope="col" className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th><th scope="col" className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nível de Risco</th></tr>
                    </thead>
                    <tbody className="bg-white divide-y divide-gray-200">
                        {mockCasesData.map((c) => (<tr key={c.id} className="hover:bg-gray-50 cursor-pointer" onClick={() => setSelectedCase(c)}><td className="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">{c.caseNumber}</td><td className="px-6 py-4 whitespace-nowrap text-sm text-gray-700">{c.parties.defendant}</td><td className="px-6 py-4 whitespace-nowrap text-sm text-gray-700">{c.status}</td><td className="px-6 py-4 whitespace-nowrap text-sm"><span className={`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${getRiskColor(c.riskLevel)}`}>{c.riskLevel}</span></td></tr>))}
                    </tbody>
                </table>
            </div>
            {selectedCase && (<div className="fixed inset-0 bg-black bg-opacity-50 z-40 flex justify-center items-center" onClick={() => setSelectedCase(null)}><div className="bg-white rounded-lg shadow-xl w-full max-w-3xl max-h-[90vh] overflow-y-auto" onClick={e => e.stopPropagation()}><div className="p-6"><div className="flex justify-between items-start"><div><h3 className="text-2xl font-bold text-gray-900">{selectedCase.subject}</h3><p className="text-sm text-gray-500 mt-1">{selectedCase.caseNumber}</p></div><button onClick={() => setSelectedCase(null)} className="text-gray-400 hover:text-gray-600"><CloseIcon/></button></div><div className="mt-4 border-t pt-4"><h4 className="font-semibold text-gray-800 mb-3">Resumo do Caso</h4><p className="text-gray-700 text-sm mb-4">{selectedCase.details.summary}</p><h4 className="font-semibold text-gray-800 mb-3">Indicadores de Abuso Identificados</h4><ul className="list-disc list-inside space-y-2 mb-4">{selectedCase.details.indicators.map((indicator, index) => (<li key={index} className="text-sm text-yellow-800 bg-yellow-50 p-2 rounded-md">{indicator}</li>))}</ul><h4 className="font-semibold text-gray-800 mb-3">Documentos Relevantes</h4><div className="flex flex-wrap gap-2">{selectedCase.details.documents.map((doc, index) => (<span key={index} className="px-3 py-1 text-xs font-medium rounded-full bg-blue-100 text-blue-800">{doc}</span>))}</div></div></div></div></div>)}
        </div>
    );
};

const GeminiResponseRenderer = ({ responseText }) => {
    if (!responseText) return null;
    const sections = responseText.split('### ').slice(1);
    return (<div className="space-y-6">{sections.map((section, index) => { const lines = section.split('\n'); const title = lines[0].trim(); const content = lines.slice(1).filter(line => line.trim() !== ''); return ( <div key={index}><h4 className="text-lg font-semibold text-gray-800 border-b pb-2 mb-3">{title}</h4><div className="space-y-2">{content.map((line, lineIndex) => { if (line.trim().startsWith('- ')) { return (<div key={lineIndex} className="flex items-start text-gray-700"><span className="text-indigo-500 mr-3 mt-1">&#8226;</span><span>{line.trim().substring(2)}</span></div>); } return <p key={lineIndex} className="text-gray-700">{line}</p>; })}</div></div> ); })}</div>);
};

const AnaliseDeDadosIAModule = ({ onAnalysisComplete }) => {
    const [caseText, setCaseText] = useState('Reclamante alega horas extras não pagas, mas a empresa possui um sistema de ponto biométrico que foi verificado em inspeção judicial e considerado regular. O advogado do reclamante possui outras 50 ações idênticas contra a mesma empresa, com as mesmas alegações. Há risco de fraude e litigância predatória.');
    const [isAnalyzing, setIsAnalyzing] = useState(false);
    const [analysisResult, setAnalysisResult] = useState('');
    const handleAnalyzeWithAI = async () => { if (!caseText.trim()) return; setIsAnalyzing(true); setAnalysisResult(''); let text = ''; const prompt = `Aja como um advogado sênior e estrategista. Analise o seguinte relato de um caso jurídico. Forneça uma resposta estruturada usando a formatação "### Título" para os cabeçalhos e "- " para listas. A resposta deve conter EXATAMENTE os seguintes cabeçalhos:\n### Resumo do Caso\n### Pontos de Atenção e Riscos\n### Sugestão de Estratégia\n\nTexto do caso para análise:\n---\n${caseText}\n---`; try { const payload = { contents: [{ role: "user", parts: [{ text: prompt }] }] }; const apiKey = ""; const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`; const response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) }); if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`); const result = await response.json(); text = result.candidates?.[0]?.content?.parts?.[0]?.text || ''; if (text) { setAnalysisResult(text); } else { setAnalysisResult("Erro: A resposta da IA estava em um formato inesperado."); } } catch (error) { console.error("Erro ao chamar a API do Gemini:", error); setAnalysisResult("Ocorreu um erro ao gerar a análise. Tente novamente."); } finally { setIsAnalyzing(false); if (text && (text.toLowerCase().includes('risco') || text.toLowerCase().includes('fraude') || text.toLowerCase().includes('abusiva') || text.toLowerCase().includes('predatória'))) { onAnalysisComplete(true); } } };
    return (<div><h2 className="text-3xl font-semibold text-gray-800 mb-2">Análise de Dados e Estratégia com IA</h2><p className="text-gray-600 mb-6">Descreva os fatos de um caso e a IA irá gerar um resumo, identificar riscos e sugerir estratégias.</p><div className="bg-white p-6 rounded-lg shadow-md mb-6"><h3 className="text-xl font-semibold text-gray-700 mb-4">1. Descreva o Caso</h3><textarea value={caseText} onChange={(e) => setCaseText(e.target.value)} placeholder="Cole ou descreva aqui os fatos, petições ou documentos relevantes para a análise..." className="w-full h-40 p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" /> <button onClick={handleAnalyzeWithAI} disabled={!caseText.trim() || isAnalyzing} className="mt-4 w-full sm:w-auto flex items-center justify-center gap-2 px-6 py-3 border border-transparent text-base font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 disabled:bg-indigo-300"><SparkleIcon /> {isAnalyzing ? 'Analisando...' : 'Gerar Resumo e Análise Estratégica'}</button></div>{(isAnalyzing || analysisResult) && (<div className="bg-white p-6 rounded-lg shadow-md"><h3 className="text-xl font-semibold text-gray-700 mb-4">2. Análise Estratégica da IA</h3>{isAnalyzing && <p className="text-indigo-700">Aguarde, a IA está processando sua solicitação...</p>}{analysisResult && <GeminiResponseRenderer responseText={analysisResult} />}</div>)}</div>);
};

const DeteccaoDeFraudesModule = () => {
    const [isScanning, setIsScanning] = useState(false);
    const [scanResults, setScanResults] = useState([]);

    const handleScan = () => {
        setIsScanning(true);
        setScanResults([]);
        setTimeout(() => {
            const highRiskCases = mockCasesData.filter(c => c.riskLevel === 'Alto' || c.riskLevel === 'Crítico');
            const results = {};
            
            highRiskCases.forEach(c => {
                 if (c.details.indicators.some(ind => ind.includes("Concentração de grande volume") || ind.includes("50 ações idênticas"))) {
                    if(!results['l']) results['l'] = { indicator: cnjIndicators.find(i => i.id === 'l'), cases: []};
                    results['l'].cases.push(c);
                 }
                 if (c.details.indicators.some(ind => ind.includes("petições genéricas") || ind.includes("causas de pedir idênticas"))) {
                    if(!results['g']) results['g'] = { indicator: cnjIndicators.find(i => i.id === 'g'), cases: []};
                    results['g'].cases.push(c);
                 }
                 if (c.details.indicators.some(ind => ind.includes("assédio processual"))) {
                     if(!results['m']) results['m'] = { indicator: cnjIndicators.find(i => i.id === 'm'), cases: []};
                     results['m'].cases.push(c);
                 }
            });
            
            setScanResults(Object.values(results));
            setIsScanning(false);
        }, 2500);
    };

    return (
        <div>
            <h2 className="text-3xl font-semibold text-gray-800 mb-2">Detecção de Fraudes e Litigância Abusiva</h2>
            <p className="text-gray-600 mb-6">Inicie uma varredura para identificar padrões de conduta abusiva nos casos ativos, com base na Recomendação 159/2024 do CNJ.</p>

            <div className="bg-white p-6 rounded-lg shadow-md mb-6">
                <button onClick={handleScan} disabled={isScanning} className="w-full sm:w-auto flex items-center justify-center gap-2 px-6 py-3 border border-transparent text-base font-medium rounded-md text-white bg-red-600 hover:bg-red-700 disabled:bg-red-300 transition-colors">
                    <SearchIcon/>
                    {isScanning ? 'Varrendo Casos...' : 'Iniciar Varredura de Fraudes'}
                </button>
            </div>

            {isScanning && ( <div className="text-center p-6 bg-white rounded-lg shadow-md"> <p className="text-red-700 font-semibold animate-pulse">Analisando base de dados em busca de padrões...</p> </div> )}
            
            {!isScanning && scanResults.length === 0 && ( <div className="text-center p-6 bg-white rounded-lg shadow-md"> <p className="text-gray-500">Nenhum padrão de fraude detectado na última varredura ou a varredura não foi iniciada.</p> </div> )}
            
            {scanResults.length > 0 && (
                 <div className="space-y-6">
                    <h3 className="text-2xl font-semibold text-gray-800">Resultados da Varredura</h3>
                    {scanResults.map(({indicator, cases}) => (
                        <div key={indicator.id} className="bg-white p-6 rounded-lg shadow-md border-l-4 border-red-500">
                           <h4 className="text-xl font-bold text-red-700">{indicator.title}</h4>
                           <p className="text-gray-600 mt-1">{indicator.description}</p>
                           <p className="text-xs text-gray-500 mt-1">Enquadramento: {indicator.cpc}</p>
                           <div className="mt-4">
                               <h5 className="font-semibold text-gray-800 mb-2">Casos Relacionados ({cases.length}):</h5>
                               <div className="flex flex-wrap gap-2">
                                   {cases.map(c => (
                                       <span key={c.id} className="px-3 py-1 text-sm font-medium rounded-full bg-red-100 text-red-800">
                                           {c.caseNumber}
                                       </span>
                                   ))}
                               </div>
                           </div>
                        </div>
                    ))}
                 </div>
            )}
        </div>
    );
};

const fileToBase64 = (file) => new Promise((resolve, reject) => { const reader = new FileReader(); reader.readAsDataURL(file); reader.onload = () => resolve(reader.result.split(',')[1]); reader.onerror = error => reject(error); });

const AnaliseBoletoSubModule = () => {
    const [file, setFile] = useState(null);
    const [isAnalyzing, setIsAnalyzing] = useState(false);
    const [analysisResult, setAnalysisResult] = useState('');
    const [error, setError] = useState('');
    const [preview, setPreview] = useState(null);

    const handleFileChange = (e) => {
        const selectedFile = e.target.files[0];
        if (selectedFile) {
            setFile(selectedFile);
            setAnalysisResult('');
            setError('');
            const reader = new FileReader();
            reader.onloadend = () => { setPreview(reader.result); };
            reader.readAsDataURL(selectedFile);
        }
    };
    
    const handleAnalyze = async () => {
        if (!file) return;
        setIsAnalyzing(true);
        setError('');
        setAnalysisResult('');

        try {
            const base64Data = await fileToBase64(file);
            const prompt = "Aja como um perito em fraudes de documentos financeiros. Analise a imagem deste boleto bancário em detalhes. Identifique e liste quaisquer sinais de fraude, como adulteração na linha digitável, inconsistências no código de barras, informações suspeitas do beneficiário, erros de formatação ou qualquer outro elemento que pareça fora do padrão. Forneça uma conclusão clara sobre a probabilidade de fraude (baixa, média ou alta) e elabore um parecer técnico estruturado com os seguintes cabeçalhos: ### Análise Visual\n### Verificação de Dados\n### Conclusão Pericial.";
            const payload = { contents: [{ role: "user", parts: [ { text: prompt }, { inlineData: { mimeType: file.type, data: base64Data } } ] }] };
            const apiKey = "";
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;
            const response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
            if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
            const result = await response.json();
            const text = result.candidates?.[0]?.content?.parts?.[0]?.text;
            if (text) { setAnalysisResult(text); } else { throw new Error("A resposta da IA estava vazia ou em formato inesperado."); }
        } catch (err) {
            console.error("Erro na análise do boleto:", err);
            setError("Falha ao analisar o documento. A API pode estar indisponível ou o formato do arquivo não é suportado. Tente novamente.");
        } finally {
            setIsAnalyzing(false);
        }
    };

    return (
        <div className="space-y-6">
            <div className="bg-white p-6 rounded-lg shadow-md">
                <h3 className="text-xl font-semibold text-gray-700 mb-4">1. Upload do Boleto</h3>
                <label className="w-full flex flex-col items-center px-4 py-6 bg-white text-indigo-600 rounded-lg shadow-lg tracking-wide uppercase border border-indigo-600 cursor-pointer hover:bg-indigo-600 hover:text-white transition-colors">
                    <UploadIcon />
                    <span className="mt-2 text-base leading-normal">{file ? file.name : 'Selecione a imagem do boleto'}</span>
                    <input type='file' className="hidden" onChange={handleFileChange} accept="image/png, image/jpeg, image/webp" />
                </label>
                {preview && <img src={preview} alt="Pré-visualização" className="mt-4 max-h-80 rounded-lg shadow-sm mx-auto" />}
            </div>
            <button onClick={handleAnalyze} disabled={!file || isAnalyzing} className="w-full sm:w-auto flex items-center justify-center gap-2 px-6 py-3 border border-transparent text-base font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 disabled:bg-indigo-300 transition-colors"><SparkleIcon />{isAnalyzing ? 'Analisando com IA...' : 'Analisar Boleto'}</button>
            {error && <div className="p-4 bg-red-100 text-red-800 rounded-lg">{error}</div>}
            {analysisResult && (<div className="bg-gray-50 p-6 rounded-lg border shadow-inner"><h3 className="text-xl font-semibold text-gray-800 mb-4">Parecer Técnico da IA</h3><GeminiResponseRenderer responseText={analysisResult} /></div>)}
        </div>
    );
};

const ValidacaoAssinaturaSubModule = () => {
     const [file, setFile] = useState(null);
     const [isAnalyzing, setIsAnalyzing] = useState(false);
     const [result, setResult] = useState('');

    const handleFileChange = (e) => { setFile(e.target.files[0]); setResult(''); };
    
    const handleValidation = () => {
        if (!file) return;
        setIsAnalyzing(true);
        setTimeout(() => {
            const isValid = Math.random() > 0.3;
            setResult({ isValid, summary: isValid ? "Assinatura digital VERIFICADA e em conformidade com o padrão ICP-Brasil." : "ALERTA: A assinatura digital não pôde ser validada ou apresenta inconsistências.", details: [ { label: "Certificado Digital", value: isValid ? "Válido (AC-JUS)" : "Não Confiável / Revogado", ok: isValid }, { label: "Carimbo de Tempo", value: isValid ? "Sincronizado e Válido" : "Ausente ou Inválido", ok: isValid }, { label: "Integridade do Documento", value: isValid ? "Preservada após assinatura" : "Potencialmente alterado", ok: isValid }, ] });
            setIsAnalyzing(false);
        }, 2500);
    };

    return (
         <div className="space-y-6">
            <div className="bg-white p-6 rounded-lg shadow-md">
                <h3 className="text-xl font-semibold text-gray-700 mb-4">1. Upload da Procuração</h3>
                <label className="w-full flex flex-col items-center px-4 py-6 bg-white text-indigo-600 rounded-lg shadow-lg tracking-wide uppercase border border-indigo-600 cursor-pointer hover:bg-indigo-600 hover:text-white transition-colors">
                    <UploadIcon />
                    <span className="mt-2 text-base leading-normal">{file ? file.name : 'Selecione o documento com assinatura'}</span>
                    <input type='file' className="hidden" onChange={handleFileChange} accept=".pdf" />
                </label>
            </div>
            <button onClick={handleValidation} disabled={!file || isAnalyzing} className="w-full sm:w-auto flex items-center justify-center gap-2 px-6 py-3 border border-transparent text-base font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 disabled:bg-indigo-300 transition-colors">{isAnalyzing ? 'Validando Assinatura...' : 'Validar Assinatura Digital'}</button>
            {result && (<div className={`p-6 rounded-lg shadow-inner ${result.isValid ? 'bg-green-50 border-green-500' : 'bg-red-50 border-red-500'} border-l-4`}><h3 className={`text-xl font-bold mb-4 ${result.isValid ? 'text-green-800' : 'text-red-800'}`}>{result.summary}</h3><div className="space-y-2">{result.details.map((item, index) =>(<div key={index} className="flex justify-between items-center text-sm"><span className="font-semibold text-gray-700">{item.label}:</span><span className={`font-bold ${item.ok ? 'text-green-700' : 'text-red-700'}`}>{item.value}</span></div>))}</div></div>)}
        </div>
    );
};

const GeolocalizacaoSubModule = () => {
    const [files, setFiles] = useState({ procuracao: null, residencia: null });
    const [isAnalyzing, setIsAnalyzing] = useState(false);
    const [result, setResult] = useState(null);

    const handleFileChange = (e, type) => { setFiles(prev => ({ ...prev, [type]: e.target.files[0] })); setResult(null); };
    
    const handleAnalyze = () => {
        if (!files.procuracao || !files.residencia) return;
        setIsAnalyzing(true);
        setTimeout(() => {
            setResult({ locations: [ { name: 'Autor (Residência)', address: 'Rua das Flores, 123, Rio de Janeiro, RJ', top: '70%', left: '65%' }, { name: 'Escritório Advocacia', address: 'Av. Paulista, 1000, São Paulo, SP', top: '40%', left: '30%' }, { name: 'Local da Assinatura (IP)', address: 'Praça da Sé, Salvador, BA', top: '85%', left: '20%' }, ], analysis: "ALERTA: A assinatura da procuração foi realizada em um local (Salvador, BA) a mais de 1.500 km do domicílio do autor (Rio de Janeiro, RJ) e do escritório de advocacia (São Paulo, SP). Esta discrepância geográfica é um forte indicador de captação irregular de clientes e deve ser investigada." });
            setIsAnalyzing(false);
        }, 2000);
    };

    return (
        <div className="space-y-6">
            <div className="bg-white p-6 rounded-lg shadow-md grid grid-cols-1 md:grid-cols-2 gap-6">
                 <label className="w-full flex flex-col items-center px-4 py-6 bg-white text-indigo-600 rounded-lg shadow-lg tracking-wide uppercase border border-indigo-600 cursor-pointer hover:bg-indigo-600 hover:text-white transition-colors"><UploadIcon /><span className="mt-2 text-base leading-normal text-center">{files.procuracao ? files.procuracao.name : 'Upload da Procuração'}</span><input type='file' className="hidden" onChange={(e) => handleFileChange(e, 'procuracao')} accept=".pdf" /></label>
                <label className="w-full flex flex-col items-center px-4 py-6 bg-white text-indigo-600 rounded-lg shadow-lg tracking-wide uppercase border border-indigo-600 cursor-pointer hover:bg-indigo-600 hover:text-white transition-colors"><UploadIcon /><span className="mt-2 text-base leading-normal text-center">{files.residencia ? files.residencia.name : 'Upload do Comp. de Residência'}</span><input type='file' className="hidden" onChange={(e) => handleFileChange(e, 'residencia')} accept=".pdf,.jpg,.png" /></label>
            </div>
            <button onClick={handleAnalyze} disabled={!files.procuracao || !files.residencia || isAnalyzing} className="w-full sm:w-auto flex items-center justify-center gap-2 px-6 py-3 border border-transparent text-base font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 disabled:bg-indigo-300 transition-colors">{isAnalyzing ? 'Analisando Localizações...' : 'Analisar Geolocalização'}</button>
            {result && (<div className="bg-white p-6 rounded-lg shadow-md"><h3 className="text-xl font-semibold text-gray-700 mb-4">Análise Geográfica</h3><div className="relative w-full h-80 bg-gray-200 rounded-lg overflow-hidden border-2 border-gray-300 mb-4" style={{backgroundImage: `url('https://maps.googleapis.com/maps/api/staticmap?center=-14.235004,-51.92528&zoom=4&size=600x400&maptype=roadmap&key=')`, backgroundSize: 'cover' }}>{result.locations.map(loc => (<div key={loc.name} className="absolute" style={{ top: loc.top, left: loc.left, transform: 'translate(-50%, -50%)' }}><LocationMarkerIcon className="h-8 w-8 text-red-600" /><span className="absolute -bottom-6 left-1/2 -translate-x-1/2 whitespace-nowrap bg-black bg-opacity-70 text-white text-xs px-2 py-1 rounded">{loc.name}</span></div>))}</div><div className="bg-yellow-50 text-yellow-800 p-4 rounded-lg border-l-4 border-yellow-500"><p className="font-semibold">Parecer da IA:</p><p>{result.analysis}</p></div></div>)}
        </div>
    );
};

const VerificacaoDeDocumentosModule = () => {
    const [activeTab, setActiveTab] = useState('analise');
    const tabs = [ { id: 'analise', label: 'Análise de Documentos' }, { id: 'assinatura', label: 'Validação de Assinatura Digital' }, { id: 'geolocalizacao', label: 'Geolocalização' }, ];
    const renderContent = () => {
        switch (activeTab) {
            case 'analise': return <AnaliseBoletoSubModule />;
            case 'assinatura': return <ValidacaoAssinaturaSubModule />;
            case 'geolocalizacao': return <GeolocalizacaoSubModule />;
            default: return null;
        }
    };
    return (
        <div>
            <h2 className="text-3xl font-semibold text-gray-800 mb-6">Verificação de Documentos</h2>
            <div className="mb-6 border-b border-gray-200">
                <nav className="-mb-px flex space-x-6" aria-label="Tabs">
                    {tabs.map(tab => (<button key={tab.id} onClick={() => setActiveTab(tab.id)} className={`${ activeTab === tab.id ? 'border-indigo-500 text-indigo-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300' } whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm transition-colors`}>{tab.label}</button>))}
                </nav>
            </div>
            <div>{renderContent()}</div>
        </div>
    );
};


const AutomacaoDaDefesaModule = () => {
    const [caseContext, setCaseContext] = useState("Exemplo: O autor da ação alega que o reajuste do plano de saúde coletivo foi abusivo. A ré, por sua vez, sustenta que o reajuste se baseou na sinistralidade da apólice, conforme previsto em contrato e comunicado à empresa estipulante.");
    const [isLoading, setIsLoading] = useState(false);
    const [generatedThesis, setGeneratedThesis] = useState('');
    const [error, setError] = useState('');

    const defenseTheses = [
        { key: 'normas', title: 'Observância das Normas Contratuais e Regulatórias', prompt: 'Desenvolva uma tese de defesa focada na observância das normas contratuais e regulatórias (Lei nº 9.656/98 e Resoluções da ANS), argumentando que a conduta da operadora foi lícita.' },
        { key: 'tecnica', title: 'Fundamentação Técnica das Decisões', prompt: 'Desenvolva uma tese de defesa baseada na fundamentação técnica da decisão da operadora, citando pareceres de junta médica, critérios atuariais ou a Resolução Normativa nº 424/17 da ANS.' },
        { key: 'coletivos', title: 'Natureza dos Contratos Coletivos', prompt: 'Elabore uma tese de defesa destacando as especificidades dos contratos coletivos, como a livre negociação entre as partes e a inaplicabilidade das regras de reajuste dos planos individuais.'},
        { key: 'sem_prova', title: 'Ausência de Prova de Irregularidade', prompt: 'Crie uma tese de defesa focada na ausência de prova pré-constituída de irregularidade por parte do autor, argumentando que as alegações são genéricas e não comprovadas.'},
        { key: 'urgencia', title: 'Contestação da Urgência Alegada', prompt: 'Desenvolva uma tese contestando a urgência de uma tutela antecipada, especialmente em casos de reajustes antigos, questionando a presença do periculum in mora.' },
        { key: 'ans', title: 'Deferência à Agência Reguladora', prompt: 'Argumente que a ANS, como órgão técnico, possui a competência para regular o setor, e suas decisões e normativas devem ser respeitadas pelo Judiciário.' },
        { key: 'impacto', title: 'Análise de Impacto das Decisões (LINDB)', prompt: 'Elabore uma tese com base nos artigos 20 e 21 da LINDB, argumentando sobre as consequências econômicas e sistêmicas de uma decisão desfavorável, como o risco à sustentabilidade do mutualismo.'},
        { key: 'ilegitimidade', title: 'Ilegitimidade Passiva', prompt: 'Desenvolva uma preliminar de ilegitimidade passiva, explicando por que a parte acionada não é a responsável pela obrigação discutida.'},
        { key: 'dialeticidade', title: 'Dialeticidade Recursal', prompt: 'Desenvolva uma tese sobre a necessidade de dialeticidade recursal, argumentando que o recurso da parte contrária não impugna especificamente os fundamentos da decisão recorrida.'},
        { key: 'impug_vulnerabilidade', title: 'Impugnação à Vulnerabilidade Técnica', prompt: 'Argumente contra a presunção absoluta de vulnerabilidade técnica ou informacional da parte autora, especialmente em contratos empresariais ou com partes assistidas.'},
        { key: 'indeferimento_tutela', title: 'Indeferimento da Tutela de Urgência', prompt: 'Requeira o indeferimento da tutela de urgência por ausência dos requisitos legais (probabilidade do direito e perigo de dano).'},
        { key: 'producao_provas', title: 'Produção de Provas', prompt: 'Requeira a produção de provas essenciais, como prova pericial atuarial ou médica, para elucidar os pontos controvertidos.'},
        { key: 'juntada_docs', title: 'Juntada de Documentos pela Parte Autora', prompt: 'Requeira a intimação da parte autora para juntar documentos essenciais que comprovem suas alegações, sob as penas legais.'},
        { key: 'ma_fe', title: 'Litigância de Má-Fé', prompt: 'Argumente pela condenação da parte autora por litigância de má-fé, apontando as condutas processuais abusivas com base na Recomendação 159/2024 do CNJ e no art. 80 do CPC.'},
        { key: 'sem_segredo', title: 'Indeferimento do Segredo de Justiça', prompt: 'Requeira o indeferimento do pedido de segredo de justiça, argumentando pela prevalência da publicidade dos atos processuais.'},
        { key: 'improcedencia', title: 'Improcedência Total dos Pedidos', prompt: 'Requeira a improcedência total dos pedidos, consolidando os principais argumentos de mérito.'},
        { key: 'sucumbencia', title: 'Condenação em Custas e Honorários', prompt: 'Requeira a condenação da parte autora ao pagamento das custas e honorários sucumbenciais.'},
    ];

    const handleGenerateThesis = async (thesis) => {
        if (!caseContext) {
            setError("Por favor, forneça o contexto do caso.");
            return;
        }
        setIsLoading(true);
        setGeneratedThesis('');
        setError('');

        const fullPrompt = `Aja como um advogado especialista em direito da saúde suplementar. Com base no seguinte contexto de um caso, elabore um parágrafo robusto e bem fundamentado para uma peça de defesa, desenvolvendo a seguinte tese: "${thesis.title}".\n\nContexto do Caso:\n"""\n${caseContext}\n"""\n\nTese a ser desenvolvida: ${thesis.prompt}`;

        try {
            const payload = { contents: [{ role: "user", parts: [{ text: fullPrompt }] }] };
            const apiKey = "";
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;
            const response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
            if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
            
            const result = await response.json();
            const text = result.candidates?.[0]?.content?.parts?.[0]?.text;
            
            if (text) {
                setGeneratedThesis(text);
            } else {
                throw new Error("A IA não retornou uma tese.");
            }
        } catch (e) {
            console.error("Erro ao chamar API Gemini:", e);
            setError("Não foi possível gerar a tese. Por favor, tente novamente.");
        } finally {
            setIsLoading(false);
        }
    };

    return (
        <div>
            <h2 className="text-3xl font-semibold text-gray-800 mb-2">Automação da Defesa com IA</h2>
            <p className="text-gray-600 mb-6">Forneça o contexto do caso e selecione uma tese para que a IA desenvolva o argumento jurídico correspondente.</p>
            
            <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <div className="lg:col-span-1">
                    <h3 className="text-xl font-semibold text-gray-700 mb-4">Teses de Defesa</h3>
                    <div className="flex flex-col space-y-2 h-[60vh] overflow-y-auto pr-2">
                        {defenseTheses.map(thesis => (
                            <button key={thesis.key} onClick={() => handleGenerateThesis(thesis)} disabled={isLoading} className="text-left p-3 bg-white rounded-lg shadow-sm hover:bg-indigo-50 focus:outline-none focus:ring-2 focus:ring-indigo-500 disabled:opacity-50 transition-all">
                                <p className="font-semibold text-indigo-700">{thesis.title}</p>
                            </button>
                        ))}
                    </div>
                </div>

                <div className="lg:col-span-2">
                     <div className="bg-white p-6 rounded-lg shadow-md mb-6">
                        <h3 className="text-xl font-semibold text-gray-700 mb-4">1. Forneça o Contexto do Caso</h3>
                        <textarea value={caseContext} onChange={(e) => setCaseContext(e.target.value)} placeholder="Descreva aqui os fatos, pedidos e principais pontos do caso..." className="w-full h-40 p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-shadow" />
                    </div>
                    
                    <div className="bg-white p-6 rounded-lg shadow-md">
                        <h3 className="text-xl font-semibold text-gray-700 mb-4">2. Tese Gerada pela IA</h3>
                        {isLoading && <p className="text-indigo-700 animate-pulse">Gerando argumento... Por favor, aguarde.</p>}
                        {error && <p className="text-red-600">{error}</p>}
                        {generatedThesis && <div className="text-gray-800 whitespace-pre-wrap p-4 bg-gray-50 rounded-md border">{generatedThesis}</div>}
                    </div>
                </div>
            </div>
        </div>
    );
};

const RiskMatrix = ({ risks }) => {
    const probabilityLevels = ['Alta', 'Média', 'Baixa'];
    const impactLevels = ['Baixo', 'Médio', 'Alto'];

    const getCellColor = (prob, imp) => {
        if (prob === 'Alta' && imp === 'Alto') return 'bg-red-500';
        if (prob === 'Alta' && imp === 'Médio') return 'bg-orange-400';
        if (prob === 'Média' && imp === 'Alto') return 'bg-orange-400';
        if (prob === 'Alta' && imp === 'Baixo') return 'bg-yellow-300';
        if (prob === 'Média' && imp === 'Médio') return 'bg-yellow-300';
        if (prob === 'Baixa' && imp === 'Alto') return 'bg-yellow-300';
        return 'bg-green-300';
    };

    return (
        <div className="mt-4">
             <h4 className="font-bold text-gray-700 mb-2">Matriz de Risco</h4>
             <div className="flex">
                <div className="flex flex-col justify-around text-xs font-bold text-gray-500 -rotate-90 w-10 text-center">Probabilidade</div>
                <div className="w-full">
                    <div className="grid grid-cols-3 text-center text-xs font-bold text-gray-500">
                        {impactLevels.map(level => <div key={level}>{level}</div>)}
                    </div>
                    <div className="grid grid-cols-3 grid-rows-3 gap-1 mt-1">
                        {probabilityLevels.map(probLevel => (
                            <React.Fragment key={probLevel}>
                                {impactLevels.map(impLevel => (
                                    <div key={`${probLevel}-${impLevel}`} className={`h-16 w-full rounded-md flex items-center justify-center ${getCellColor(probLevel, impLevel)}`}>
                                        {risks.filter(r => r.probability === probLevel && r.impact === impLevel).map((risk, index) => (
                                            <div key={index} className="h-4 w-4 bg-gray-800 rounded-full border-2 border-white" title={risk.type}></div>
                                        ))}
                                    </div>
                                ))}
                            </React.Fragment>
                        ))}
                    </div>
                     <div className="text-center text-xs font-bold text-gray-500 mt-1">Impacto</div>
                </div>
             </div>
        </div>
    );
};


const GestaoDeRiscosModule = () => {
    const [openAccordion, setOpenAccordion] = useState(null);

    const toggleAccordion = (caseId) => {
        setOpenAccordion(openAccordion === caseId ? null : caseId);
    };

    const getRiskLevelClass = (level) => {
        switch (level) {
            case 'Alta': return 'text-red-600';
            case 'Média': return 'text-yellow-600';
            case 'Baixa': return 'text-green-600';
            case 'Positivo': return 'text-blue-600';
            default: return 'text-gray-600';
        }
    };
    
    const casesWithRisks = mockCasesData.filter(c => riskAnalysisData[c.id]);

    return (
        <div>
            <h2 className="text-3xl font-semibold text-gray-800 mb-2">Gestão de Riscos Jurídicos</h2>
            <p className="text-gray-600 mb-6">Análise detalhada dos riscos e planos de mitigação para os casos mais críticos.</p>

            <div className="space-y-4">
                {casesWithRisks.map(caseInfo => (
                    <div key={caseInfo.id} className="bg-white rounded-lg shadow-md overflow-hidden">
                        <button onClick={() => toggleAccordion(caseInfo.id)} className="w-full text-left p-4 flex justify-between items-center hover:bg-gray-50 focus:outline-none">
                            <div>
                                <p className="font-semibold text-indigo-700">{caseInfo.caseNumber}</p>
                                <p className="text-sm text-gray-500">{caseInfo.subject}</p>
                            </div>
                            <div className="flex items-center space-x-4">
                                <span className={`px-3 py-1 text-xs font-semibold rounded-full ${ { 'Crítico': 'bg-red-200 text-red-800', 'Alto': 'bg-yellow-200 text-yellow-800', 'Médio': 'bg-blue-200 text-blue-800' }[caseInfo.riskLevel] }`}>
                                    Risco {caseInfo.riskLevel}
                                </span>
                                <ChevronDownIcon className={`h-6 w-6 text-gray-500 transform transition-transform ${openAccordion === caseInfo.id ? 'rotate-180' : ''}`} />
                            </div>
                        </button>

                        {openAccordion === caseInfo.id && (
                            <div className="p-6 border-t border-gray-200 bg-gray-50 grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <h3 className="text-lg font-semibold text-gray-800 mb-4">Análise Detalhada</h3>
                                    <div className="space-y-4">
                                        {riskAnalysisData[caseInfo.id].risks.map((risk, index) => (
                                            <div key={index} className="p-4 bg-white rounded-lg border border-gray-200">
                                                <h4 className="font-bold text-gray-700">{risk.type}</h4>
                                                <div className="flex space-x-4 text-sm my-2">
                                                    <span>Probabilidade: <span className={`font-semibold ${getRiskLevelClass(risk.probability)}`}>{risk.probability}</span></span>
                                                    <span>Impacto: <span className={`font-semibold ${getRiskLevelClass(risk.impact)}`}>{risk.impact}</span></span>
                                                </div>
                                                <p className="text-sm text-gray-600 mb-2">{risk.description}</p>
                                                <div className="text-sm bg-indigo-50 p-3 rounded-md">
                                                    <p className="font-semibold text-indigo-800">Plano de Mitigação:</p>
                                                    <p className="text-indigo-700">{risk.mitigation}</p>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                                <div>
                                    <RiskMatrix risks={riskAnalysisData[caseInfo.id].risks} />
                                </div>
                            </div>
                        )}
                    </div>
                ))}
            </div>
        </div>
    );
};

const ConsultaDoAdversoModule = () => {
    return (
        <div>
            <h2 className="text-3xl font-semibold text-gray-800 mb-2">Consulta do Adverso (CNA - OAB)</h2>
            <p className="text-gray-600 mb-6">Acesse a ferramenta oficial do Cadastro Nacional dos Advogados para verificar a situação da inscrição de um profissional.</p>
            
            <div className="bg-white p-8 rounded-lg shadow-md text-center">
                <h3 className="text-xl font-semibold text-gray-700 mb-4">Acesso ao Portal da OAB</h3>
                <p className="text-gray-600 mb-6">
                    Por motivos de segurança, o site do CNA (Cadastro Nacional dos Advogados) não permite ser incorporado diretamente em outras plataformas. Para garantir uma consulta segura e com dados oficiais, utilize o botão abaixo para abrir o portal da OAB em uma nova aba.
                </p>
                <a 
                    href="https://cna.oab.org.br/" 
                    target="_blank" 
                    rel="noopener noreferrer" 
                    className="inline-flex items-center justify-center gap-2 py-3 px-6 border border-transparent rounded-md shadow-sm text-base font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-all"
                >
                    <ExternalLinkIcon />
                    Acessar o CNA da OAB
                </a>
            </div>
        </div>
    );
};


const GenericModulePage = ({ moduleName }) => ( <div> <h2 className="text-3xl font-semibold text-gray-800 mb-6">{moduleName}</h2> <div className="bg-white p-8 rounded-lg shadow-md text-center"> <p className="text-gray-600">O conteúdo para o módulo <span className="font-semibold text-indigo-600">{moduleName}</span> será implementado aqui.</p> </div> </div> );

const MainLayout = ({ onLogout }) => {
  const [activeModule, setActiveModule] = useState('Dashboard');
  const [isSidebarOpen, setIsSidebarOpen] = useState(true);
  const [fraudAlert, setFraudAlert] = useState(false);
  const handleSelectModule = (moduleId) => { setActiveModule(moduleId); if (moduleId === 'DetecçãoDeFraudes') { setFraudAlert(false); } };
  
  const renderModule = () => {
    const module = modules.find(m => m.id === activeModule);
    switch (activeModule) {
      case 'Dashboard': return <Dashboard onSelectModule={handleSelectModule} />;
      case 'Overview': return <OverviewModule />;
      case 'AnáliseDeDadosEIA': return <AnaliseDeDadosIAModule onAnalysisComplete={setFraudAlert} />;
      case 'DetecçãoDeFraudes': return <DeteccaoDeFraudesModule />;
      case 'VerificaçãoDeDocumentos': return <VerificacaoDeDocumentosModule />;
      case 'AutomaçãoDaDefesa': return <AutomacaoDaDefesaModule />;
      case 'GestãoDeRiscos': return <GestaoDeRiscosModule />;
      case 'ConsultaDoAdverso': return <ConsultaDoAdversoModule />;
      default: return <GenericModulePage moduleName={module?.name || "Módulo"} />;
    }
  };

  return ( <div className="flex h-screen bg-gray-100 font-sans"> <Sidebar activeModule={activeModule} onSelectModule={handleSelectModule} onLogout={onLogout} isSidebarOpen={isSidebarOpen} fraudAlert={fraudAlert} /> <div className="flex-1 flex flex-col overflow-hidden"> <header className="flex justify-between items-center p-4 bg-white border-b"> <button onClick={() => setIsSidebarOpen(!isSidebarOpen)} className="text-gray-500 hover:text-gray-700 focus:outline-none">{isSidebarOpen ? <CloseIcon /> : <MenuIcon />}</button> <div className="flex items-center space-x-4"><span className="text-gray-600">Bem-vindo, Dr. Exemplo</span><div className="w-10 h-10 bg-indigo-200 rounded-full flex items-center justify-center"> <UserIcon className="text-indigo-600" /> </div></div> </header> <main className="flex-1 overflow-x-hidden overflow-y-auto bg-gray-100 p-6"> {renderModule()} </main> </div> </div> );
};

export default function App() {
  const [isLoggedIn, setIsLoggedIn] = useState(false);
  const handleLogin = () => setIsLoggedIn(true);
  const handleLogout = () => setIsLoggedIn(false);
  if (!isLoggedIn) return <LoginPage onLogin={handleLogin} />;
  return <MainLayout onLogout={handleLogout} />;
}
